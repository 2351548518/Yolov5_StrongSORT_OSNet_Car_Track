# 针对雾天交通视频的去雾算法研究

去雾算法旨在改善雾天室外捕获的视频或图像存在对比度降低，饱和度下降的情况，从而导致图像质量大大降低，或存在严重模糊感。目前图像的去雾算法主要分为三大类，分别为基于图像增强的方法、基于图像复原的方法、基于深度学习的方法。本项目中，拟对各种视频去雾算法进行研究，分析其优缺点，以选择适合本项目的合适算法。此外，在已有算法的基础上，尽所能考虑对算法进行优化或改进，以有助于后续检测和跟踪任务的开展。

| 算法                                   | 优点               | 缺点                     |
| -------------------------------------- | ------------------ | ------------------------ |
| 基于直方图均衡化的去雾算法             | 简单便捷，易于实现 | 图像失真，细节缺失       |
| 基于融合同态滤波的直方图均衡化去雾算法 | 简单便捷，效果较好 | 细节缺失                 |
| 基于小波变换的去雾算法                 | 效果较好           | 细节缺失                 |
| 基于Retinnex理论的去雾算法             | 应用广泛，效果优秀 | 处理速度慢，无法实时处理 |

因此可以考虑使用去雾算法来提高雾天图像的对比度，突出图像的部分细节，以此来改善图像的视觉效果。目前已经有非常成熟的图像去雾算法，我们考虑使用基于图像增强的图像增强方法。直方图均衡化算法属于最普遍的图像增强方法，在雾霾天气采集图像的直方图通常会集中于一个较为狭窄的范围内，因此一般通过累积分布函数拉伸直方图的动态范围使其更加均衡，借此增强雾天图像的对比度。单纯的直方图均衡化虽然简单便捷，但容易出现图像失真等明显缺点，**因此可以选择融合直方图均衡化算法，即在传统直方图均衡化的基础上，应用同态滤波算法进行改良，以此来对雾天图像进行更有效的去雾处理**。为了解决图像的光照不均问题，首先可以采用同态滤波算法，将复杂的非线性问题使用对数运算线性化，然后分离高频和低频分量，再将低频信息使用高通滤波器进行有效抑制，接着再处理图像的低频分量，对其使用直方图均衡化算法来达到非线性拉伸效果，扩大直方图范围，将图像的像素值重新进行合理分配，最终获得清晰的去雾图片。再将其作为输入送入计算机视觉系统。

## 基于直方图均衡化的去雾算法

### 直方图均衡化

直方图均衡化的目的是将原始图像的灰度级均匀地映射到整个灰度级范围内，得到一个灰度级分布均衡的图像。这种均衡化，即实现了灰度值统计上的概率均衡，也实现了人类视觉系统上（HSV）的视觉均衡。

一般来说，直方图均衡化可以达到增强图像显示效果的目的。最常用的比如去雾。下面，我们来分别实现灰度图像去雾以及彩色图像去雾。

### 实现灰度图像去雾

在[OpenCV](https://so.csdn.net/so/search?q=OpenCV&spm=1001.2101.3001.7020)中，它提供了函数cv2.equalizeHist()来实现直方图均衡化，该函数的完整定义如下：

```python
def equalizeHist(src, dst=None):
```

src：原始图像，必须是8位单通道原始图像

dst：返回值，返回直方图均值化处理结果

下面，我们来通过该函数实现灰度图像直方图均衡化处理，代码如下：

```python
import cv2
import matplotlib.pyplot as plt

img = cv2.imread("45.jpg", 0)
equ = cv2.equalizeHist(img)

cv2.imshow("1",img)
cv2.imshow("2",equ)
plt.figure("原始图像直方图")
plt.hist(img.ravel(), 256)
plt.figure("均衡化图像直方图")
plt.hist(equ.ravel(), 256)
plt.show()

cv2.waitKey()
cv2.destroyAllWindows()
```

运行之后，效果如下：

![img](https://raw.githubusercontent.com/2351548518/images/main/20220717/202208292007758.png)

左边为原图，右边是处理后的图像，可以看到图像前景的雾，基本已经去掉了。不过，我们还是看看处理前后的直方图结果分布。

![img](https://raw.githubusercontent.com/2351548518/images/main/20220717/202208292009044.png)

![img](https://raw.githubusercontent.com/2351548518/images/main/20220717/202208292010246.png)

### 实现彩色图像去雾

虽然上面的灰度图像达到了去雾的基本效果，但是说实话，大多数实际的场景中，我们用到最多的往往是彩色图像。所以，掌握彩色图像的直方图均衡化处理，才是我们真正的实战技能。

下面我们来用代码实现彩色图像直方图均衡化处理，代码如下：

```python
import cv2
import matplotlib.pyplot as plt

img = cv2.imread("50.jpg")

blue = img[:, :, 0]
green = img[:, :, 1]
red = img[:, :, 2]
blue_equ = cv2.equalizeHist(blue)
green_equ = cv2.equalizeHist(green)
red_equ = cv2.equalizeHist(red)
equ = cv2.merge([blue_equ, green_equ, red_equ])

cv2.imshow("1",img)
cv2.imshow("2",equ)
plt.figure("原始图像直方图")
plt.hist(img.ravel(), 256)
plt.figure("均衡化图像直方图")
plt.hist(equ.ravel(), 256)
plt.show()

cv2.waitKey()
cv2.destroyAllWindows()
```

这里，我们只需要使用equalizeHist()函数对彩色图像的每个颜色进行均衡化处理即可。当然，需要注意的是，我们处理完每个颜色之后，需要将图像再次合并。运行之后效果如下：

![img](https://raw.githubusercontent.com/2351548518/images/main/20220717/202208292011283.png)

## 基于融合同态滤波的直方图均衡化去雾算法



## 基于小波变换的去雾算法



## 基于Retinnex理论的去雾算法

[(9条消息) OpenCV—Python Retinex图像增强算法_SongpingWang的博客-CSDN博客](https://blog.csdn.net/wsp_1138886114/article/details/83096109)



